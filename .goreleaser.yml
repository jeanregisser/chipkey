version: 2

builds:
  - id: darwin-arm64
    goos: [darwin]
    goarch: [arm64]
    env: ["CGO_ENABLED=1"]
    ldflags: ["-s -w -X main.version={{.Version}} -X main.commit={{.Commit}} -X main.date={{.Date}}"]

  - id: darwin-amd64
    goos: [darwin]
    goarch: [amd64]
    env: ["CGO_ENABLED=1"]
    ldflags: ["-s -w -X main.version={{.Version}} -X main.commit={{.Commit}} -X main.date={{.Date}}"]

  - id: default
    goos: [linux, windows]
    goarch: [amd64, arm64]
    env: ["CGO_ENABLED=0"]
    ldflags: ["-s -w -X main.version={{.Version}} -X main.commit={{.Commit}} -X main.date={{.Date}}"]

universal_binaries:
  - ids: [darwin-arm64, darwin-amd64]
    replace: true

archives:
  - name_template: >-
      {{ .ProjectName }}_{{ .Version }}_{{ .Os }}_
      {{- if eq .Arch "all" }}universal{{ else }}{{ .Arch }}{{ end }}
    format_overrides:
      - goos: windows
        format: zip

checksum:
  name_template: checksums.txt

release:
  mode: replace

changelog:
  sort: asc
  groups:
    - title: Features
      regexp: "^feat"
    - title: Bug Fixes
      regexp: "^fix"
    - title: Others
      order: 999
